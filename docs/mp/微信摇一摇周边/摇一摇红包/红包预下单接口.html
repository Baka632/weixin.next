
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link onerror="wx_loaderror(this)" onerror="wx_loaderror(this)" rel="stylesheet" type="text/css" href="https://res.wx.qq.com/mpres/htmledition/style/page/resource/res_iframe2f613f.css"/></head>
<body class="page_doc">
<div class="main_hd"><h2>红包预下单接口</h2>
</div>
<div class="main_bd">
<div class="article_box">
<div class="inner">
<div class="news_content">
<p></p>
<p><strong>接口说明</strong>
<br></p>
<p><span>设置单个红包的金额，类型等，生成红包信息。预下单完成后，需要在72小时内调用jsapi完成抽红包的操作。（红包过期失效后，资金会退回到商户财付通帐号。）</span></p>
<p><span><strong>接口调用说明</strong></span></p>
<div data-tag="backcolor">
<p><span>服务器端调用<br>http请求方式: POST</span><a href="https://api.mch.weixin.qq.com/mmpaymkttransfers/hbpreorder" _src="https://api.mch.weixin.qq.com/mmpaymkttransfers/hbpreorder"><span>https://api.mch.weixin.qq.com/mmpaymkttransfers/hbpreorder</span></a></p>
<p><span>POST数据格式：XML<br>需要商户证书
<br></span></p>
</div>
<p><span><strong>请求参数说明</strong></span></p>
<table class="table" width="951">
<tbody class="tbody">
<tr class="firstRow thead"><td class="table_cell" width="77" valign="top"><span>参数</span></td><td class="table_cell" width="103" valign="top"><span>字段</span></td><td class="table_cell" width="67" valign="top"><span>是否必须</span></td><td class="table_cell" width="156" valign="top"><span>示例值</span></td><td class="table_cell" width="97" valign="top"><span>类型</span></td><td class="table_cell" width="149" valign="top"><span>说明</span></td></tr>
<tr><td class="table_cell" width="77"><span>随机字符串</span></td><td class="table_cell" width="103"><span>nonce_str</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>5K8264ILTKCH16CQ2502SI8Z</span>
<p><span>NMTM67VS</span></p>
</td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>随机字符串，不长于32位</span></td></tr>
<tr><td class="table_cell" width="77"><span>签名</span></td><td class="table_cell" width="103"><span>sign</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>C380BEC2BFD727A4B68451335</span>
<p><span>19F3AD6</span></p>
</td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>生成签名方式查看签名算法</span></td></tr>
<tr><td class="table_cell" width="77"><span>商户订单号</span></td><td class="table_cell" width="103"><span>mch_billno</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>10000098201411111234567890</span></td><td class="table_cell" width="97"><span>String(28)</span></td><td class="table_cell" width="149"><span>商户订单号（每个订单号必须唯一）组成： mch_id+yyyymmdd+10位一天内不能重复的数字。接口根据商户订单号支持重入， 如出现超时可再调用。</span></td></tr>
<tr><td class="table_cell" width="77"><span>商户号</span></td><td class="table_cell" width="103"><span>mch_id</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>10000098</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>红包提供者的商户号（微信支付分配的商户号）</span></td></tr>
<tr><td class="table_cell" width="77"><span>公众账号appid</span></td><td class="table_cell" width="103"><span>wxappid</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>wx8888888888888888</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>红包提供者公众号的appid，对应头像展示在红包页面</span></td></tr>
<tr><td class="table_cell" width="77"><span>商户名称</span></td><td class="table_cell" width="103"><span>send_name</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>天虹百货</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>红包提供者名称，展示在红包页面</span></td></tr>
<tr><td class="table_cell" width="77"><span>红包类型</span></td><td class="table_cell" width="103"><span>hb_type</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>NORMAL</span></td><td class="table_cell" width="97"><span>String(16)</span></td><td class="table_cell" width="149"><span>NORMAL-普通红包；GROUP-裂变红包(可分享红包给好友，无关注公众号能力)。</span></td></tr>
<tr><td class="table_cell" width="77"><span>总金额</span></td><td class="table_cell" width="103"><span>total_amount</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>1000</span></td><td class="table_cell" width="97"><span>int</span></td><td class="table_cell" width="149"><span>总付款金额，单位分</span></td></tr>
<tr><td class="table_cell" width="77"><span>红包发放总人数</span></td><td class="table_cell" width="103"><span>total_num</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>1</span></td><td class="table_cell" width="97"><span>int</span></td><td class="table_cell" width="149"><span>红包发放总人数，即总共有多少人可以领到该组红包（包括分享者）。普通红包填1，裂变红包必须大于1。</span></td></tr>
<tr><td class="table_cell" width="77"><span>红包金额设置方式</span></td><td class="table_cell" width="103"><span>amt_type</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>ALL_RAND</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>红包金额设置方式，只对裂变红包生效。ALL_RAND—全部随机</span></td></tr>
<tr><td class="table_cell" width="77"><span>红包祝福语</span></td><td class="table_cell" width="103"><span>wishing</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>感谢您参加猜灯谜活动，祝您元宵节快乐</span></td><td class="table_cell" width="97"><span>String(16)</span></td><td class="table_cell" width="149"><span>红包祝福语，展示在红包页面</span></td></tr>
<tr><td class="table_cell" width="77"><span>活动名称</span></td><td class="table_cell" width="103"><span>act_name</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>猜灯谜抢红包活动</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>活动名称，在不支持原生红包的微信版本中展示在红包消息</span></td></tr>
<tr><td class="table_cell" width="77"><span>备注</span></td><td class="table_cell" width="103"><span>remark</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>猜越多得越多，快来抢！</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>备注信息，在不支持原生红包的微信版本中展示在红包消息</span></td></tr>
<tr><td class="table_cell" width="77"><span>授权商户号</span></td><td class="table_cell" width="103"><span>auth_mchid</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>1000052601</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>用于发红包时微信支付识别摇周边红包，所有开发者统一填写摇周边平台的商户号：1000052601</span></td></tr>
<tr><td class="table_cell" width="77"><span>授权商户APPID</span></td><td class="table_cell" width="103"><span>auth_appid</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>wxbf42bd79c4391863</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>用于发红包时微信支付识别摇周边红包，所有开发者统一填写摇周边平台的appid:wxbf42bd79c4391863</span></td></tr>
<tr><td class="table_cell" width="77"><span>风控设置</span></td><td class="table_cell" width="103"><span>risk_cntl</span></td><td class="table_cell" width="67"><span>是</span></td><td class="table_cell" width="156"><span>NORMAL</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="149"><span>用于管控接口风险。具体值如下：NORMAL—正常情况；IGN_FREQ_LMT—忽略防刷限制，强制发放；IGN_DAY_LMT—忽略单用户日限额限制，强制发放；IGN_FREQ_DAY_LMT—忽略防刷和单用户日限额限制，强制发放；如无特殊要求，请设为NORMAL。若忽略某项风险控制，可能造成资金损失，请谨慎使用。 &nbsp; &nbsp;</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p><span><strong>请求示例</strong></span></p>
<div data-tag="backcolor">
<p><span>&lt;xml&gt; &nbsp; &nbsp;&nbsp;<br>&lt;sign&gt;&lt;![CDATA[E1EE61A91C8E90F299DE6AE075D60A2D]]&gt;&lt;/sign&gt; &nbsp; &nbsp;&nbsp;<br>&lt;mch_billno&gt;&lt;![CDATA[0010010404201411170000046545]]&gt;&lt;/mch_billno&gt; &nbsp; &nbsp;&nbsp;<br>&lt;mch_id&gt;&lt;![CDATA[10000097]]&gt;&lt;/mch_id&gt; &nbsp; &nbsp;&nbsp;<br>&lt;wxappid&gt;&lt;![CDATA[wxcbda96de0b165486]]&gt;&lt;/wxappid&gt; &nbsp; &nbsp;&nbsp;<br>&lt;send_name&gt;&lt;![CDATA[send_name]]&gt;&lt;/send_name&gt; &nbsp; &nbsp;&nbsp;<br>&lt;hb_type&gt;&lt;![CDATA[NORMAL]]&gt;&lt;/hb_type&gt; &nbsp; &nbsp;&nbsp;<br>&lt;auth_mchid&gt;&lt;![CDATA[10000098]]&gt;&lt;/auth_mchid&gt; &nbsp; &nbsp;&nbsp;<br>&lt;auth_appid&gt;&lt;![CDATA[wx7777777]]&gt;&lt;/auth_appid&gt; &nbsp; &nbsp;&nbsp;<br>&lt;total_amount&gt;&lt;![CDATA[200]]&gt;&lt;/total_amount&gt; &nbsp; &nbsp;&nbsp;<br>&lt;amt_type&gt;&lt;![CDATA[ALL_RAND]]&gt;&lt;/amt_type&gt; &nbsp; &nbsp;&nbsp;<br>&lt;total_num&gt;&lt;![CDATA[3]]&gt;&lt;/total_num&gt; &nbsp; &nbsp;&nbsp;<br>&lt;wishing&gt;&lt;![CDATA[恭喜发财 ]]&gt;&lt;/wishing&gt; &nbsp; &nbsp;&nbsp;<br>&lt;act_name&gt;&lt;![CDATA[ 新年红包 ]]&gt;&lt;/act_name&gt; &nbsp; &nbsp;&nbsp;<br>&lt;remark&gt;&lt;![CDATA[新年红包 ]]&gt;&lt;/remark&gt; &nbsp; &nbsp;&nbsp;<br>&lt;risk_cntl&gt;&lt;![CDATA[NORMAL]]&gt;&lt;/risk_cntl&gt; &nbsp; &nbsp;&nbsp;<br>&lt;nonce_str&gt;&lt;![CDATA[50780e0cca98c8c8e814883e5caa672e]]&gt;&lt;/nonce_str&gt;<br>&lt;/xml&gt;&nbsp;
<br>
<br></span></p>
</div>
<p><span><strong>返回数据说明</strong></span></p>
<p><span>返回格式为xml</span></p>
<table class="table" width="951">
<tbody class="tbody">
<tr class="firstRow thead"><td class="table_cell" width="92" valign="top"><span>参数</span></td><td class="table_cell" width="116" valign="top"><span>字段</span></td><td class="table_cell" width="93" valign="top"><span>是否必须</span></td><td class="table_cell" width="106" valign="top"><span>示例值</span></td><td class="table_cell" width="117" valign="top"><span>类型</span></td><td class="table_cell" width="125" valign="top"><span>说明</span></td></tr>
<tr><td class="table_cell" width="92"><span>返回状态码</span></td><td class="table_cell" width="116"><span>return_code</span></td><td class="table_cell" width="93"><span>是</span></td><td class="table_cell" width="106"><span>SUCCESS</span></td><td class="table_cell" width="117"><span>String(16)</span></td><td class="table_cell" width="125"><span>SUCCESS/FAIL；此字段是通信标识，非交易标识，交易是否成功需要查看result_code来判断</span></td></tr>
<tr><td class="table_cell" width="92"><span>返回信息</span></td><td class="table_cell" width="116"><span>return_msg</span></td><td class="table_cell" width="93"><span>否</span></td><td class="table_cell" width="106"><span>签名失败</span></td><td class="table_cell" width="117"><span>String(128)</span></td><td class="table_cell" width="125"><span>返回信息，如非空，为错误原因 签名失败 参数格式校验错误 &nbsp;</span></td></tr>
</tbody>
</table>
<p><span>以下字段在return_code为SUCCESS的时候有返回</span></p>
<table class="table" width="951">
<tbody class="tbody">
<tr class="firstRow thead"><td class="table_cell" width="72" valign="top"><span>参数</span></td><td class="table_cell" width="107" valign="top"><span>字段</span></td><td class="table_cell" width="72" valign="top"><span>是否必须</span></td><td class="table_cell" width="186" valign="top"><span>示例值</span></td><td class="table_cell" width="104" valign="top"><span>类型</span></td><td class="table_cell" width="107" valign="top"><span>说明</span></td></tr>
<tr><td class="table_cell" width="72"><span>签名</span></td><td class="table_cell" width="107"><span>sign</span></td><td class="table_cell" width="72"><span>是</span></td><td class="table_cell" width="186"><span>C380BEC2BFD727A4B6845133519F3AD6</span></td><td class="table_cell" width="104"><span>String(32)</span></td><td class="table_cell" width="107"><span>生成签名方式查看 签名算法</span></td></tr>
<tr><td class="table_cell" width="72"><span>业务结果</span></td><td class="table_cell" width="107"><span>result_code</span></td><td class="table_cell" width="72"><span>是</span></td><td class="table_cell" width="186"><span>SUCCESS</span></td><td class="table_cell" width="104"><span>String(16)</span></td><td class="table_cell" width="107"><span>SUCCESS/FAIL</span></td></tr>
<tr><td class="table_cell" width="72"><span>错误代码</span></td><td class="table_cell" width="107"><span>err_code</span></td><td class="table_cell" width="72"><span>否</span></td><td class="table_cell" width="186"><span>SUCCESS</span></td><td class="table_cell" width="104"><span>String(32)</span></td><td class="table_cell" width="107"><span>错误码信息</span></td></tr>
<tr><td class="table_cell" width="72"><span>错误代码描述</span></td><td class="table_cell" width="107"><span>err_code_des</span></td><td class="table_cell" width="72"><span>否</span></td><td class="table_cell" width="186"><span>系统错误</span></td><td class="table_cell" width="104"><span>String(128)</span></td><td class="table_cell" width="107"><span>结果信息描述</span></td></tr>
</tbody>
</table>
<p><span>以下字段在return_code 和result_code都为SUCCESS的时候有返回</span></p>
<table class="table" width="951">
<tbody class="tbody">
<tr class="firstRow thead"><td class="table_cell" width="81" valign="top"><span>参数</span></td><td class="table_cell" width="104" valign="top"><span>字段</span></td><td class="table_cell" width="68" valign="top"><span>是否必须</span></td><td class="table_cell" width="173" valign="top"><span>示例值</span></td><td class="table_cell" width="97" valign="top"><span>类型</span></td><td class="table_cell" width="126" valign="top"><span>说明</span></td></tr>
<tr><td class="table_cell" width="81"><span>商户订单号</span></td><td class="table_cell" width="104"><span>mch_billno</span></td><td class="table_cell" width="68"><span>是</span></td><td class="table_cell" width="173"><span>10000098201411111234567890</span></td><td class="table_cell" width="97"><span>String(28)</span></td><td class="table_cell" width="126"><span>商户订单号（每个订单号必须唯一）组成： mch_id+yyyymmdd+10位一天内不能重复的数字。</span></td></tr>
<tr><td class="table_cell" width="81"><span>商户号</span></td><td class="table_cell" width="104"><span>mch_id</span></td><td class="table_cell" width="68"><span>是</span></td><td class="table_cell" width="173"><span>10000098</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="126"><span>微信支付分配的商户号</span></td></tr>
<tr><td class="table_cell" width="81"><span>公众账号appid</span></td><td class="table_cell" width="104"><span>wxappid</span></td><td class="table_cell" width="68"><span>是</span></td><td class="table_cell" width="173"><span>wx8888888888888888</span></td><td class="table_cell" width="97"><span>String(32)</span></td><td class="table_cell" width="126"><span>商户appid</span></td></tr>
<tr><td class="table_cell" width="81"><span>总金额</span></td><td class="table_cell" width="104"><span>total_amount</span></td><td class="table_cell" width="68"><span>是</span></td><td class="table_cell" width="173"><span>1000</span></td><td class="table_cell" width="97"><span>int</span></td><td class="table_cell" width="126"><span>总付款金额，单位分</span></td></tr>
<tr><td class="table_cell" width="81"><span>ticket</span></td><td class="table_cell" width="104"><span>sp_ticket</span></td><td class="table_cell" width="68"><span>是</span></td><td class="table_cell" width="173"><span>2J6MtR+SlbZ8Ga4EDi64X5</span>
<p><span>vC4Xv01ofX4uWOqqTc9kGJYhkq5 st5ucrXKxkjnC/UuvLeuhdIfiYg i4hJuJ95qjt9mwxqSBEmjGbZlL+ sqM9upoWsEjup28KPvaVrdao/Hg 6WqyqUL5E2zPHfM1sb1w==</span></p>
</td><td class="table_cell" width="97"><span>String</span></td><td class="table_cell" width="126"><span>sp_ticket，一个普通红包对应一个ticket</span></td></tr>
<tr><td class="table_cell" width="81"><span>红包订单号</span></td><td class="table_cell" width="104"><span>detail_id</span></td><td class="table_cell" width="68"><span>是</span></td><td class="table_cell" width="173"><span>0000000666201504290000042120</span></td><td class="table_cell" width="97">
<br></td><td class="table_cell" width="126"><span>红包内部订单号</span></td></tr>
<tr><td class="table_cell" width="81"><span>发送时间</span></td><td class="table_cell" width="104">
<br></td><td class="table_cell" width="68"><span>是</span></td><td class="table_cell" width="173"><span>20150429203444</span></td><td class="table_cell" width="97">
<br></td><td class="table_cell" width="126"><span>红包发放时间 &nbsp;&nbsp;</span></td></tr>
</tbody>
</table>
<p><span><strong>成功示例</strong></span></p>
<div data-tag="backcolor">
<p><span>&lt;xml&gt;&nbsp;<br>&lt;return_code&gt;&lt;![CDATA[SUCCESS]]&gt;&lt;/return_code&gt;&nbsp;<br>&lt;return_msg&gt;&lt;![CDATA[发放成功.]]&gt;&lt;/return_msg&gt;&nbsp;<br>&lt;result_code&gt;&lt;![CDATA[SUCCESS]]&gt;&lt;/result_code&gt;&nbsp;<br>&lt;err_code&gt;&lt;![CDATA[0]]&gt;&lt;/err_code&gt;&nbsp;<br>&lt;err_code_des&gt;&lt;![CDATA[发放成功.]]&gt;&lt;/err_code_des&gt;&nbsp;<br>&lt;mch_billno&gt;&lt;![CDATA[0010010404201411170000046545]]&gt;&lt;/mch_billno&gt;&nbsp;<br>&lt;mch_id&gt;10010404&lt;/mch_id&gt;&nbsp;<br>&lt;wxappid&gt;&lt;![CDATA[wx6fa7e3bab7e15415]]&gt;&lt;/wxappid&gt;&nbsp;<br>&lt;sp_ticket&gt;&lt;![CDATA[0cca98c8c8e814883]]&gt;&lt;/sp_ticket&gt;&nbsp;<br>&lt;total_amount&gt;3&lt;/total_amount&gt;&nbsp;<br>&lt;detail_id&gt;&lt;![CDATA[001001040420141117000004888]]&gt;&lt;/detail_id&gt;&nbsp;<br>&lt;send_time&gt;&lt;![CDATA[20150101080000]]&gt;&lt;/send_time&gt;&nbsp;<br>&lt;/xml&gt; &nbsp;
<br></span></p>
</div>
<p><span><strong>失败示例</strong></span></p>
<div data-tag="backcolor">
<p><span>&lt;xml&gt; &nbsp; &nbsp;&nbsp;<br>&lt;return_code&gt;&lt;![CDATA[FAIL]]&gt;&lt;/return_code&gt;&nbsp;<br>&lt;return_msg&gt;&lt;![CDATA[系统繁忙,请稍后再试.]]&gt;&lt;/return_msg&gt;&nbsp;<br>&lt;result_code&gt;&lt;![CDATA[FAIL]]&gt;&lt;/result_code&gt;&nbsp;<br>&lt;err_code&gt;&lt;![CDATA[268458547]]&gt;&lt;/err_code&gt;&nbsp;<br>&lt;err_code_des&gt;&lt;![CDATA[系统繁忙,请稍后再试.]]&gt;&lt;/err_code_des&gt;&nbsp;<br>&lt;mch_billno&gt;&lt;![CDATA[0010010404201411170000046542]]&gt;&lt;/mch_billno&gt; &nbsp; &nbsp; &nbsp; &nbsp;<br>&lt;mch_id&gt;10010404&lt;/mch_id&gt;&nbsp;<br>&lt;wxappid&gt;&lt;![CDATA[wx6fa7e3bab7e15415]]&gt;&lt;/wxappid&gt;&nbsp;<br>&lt;total_amount&gt;3&lt;/total_amount&gt;&nbsp;<br>&lt;/xml&gt;
<br></span></p>
</div>
<p><span><strong>错误码</strong></span></p>
<table class="table" width="951">
<tbody class="tbody">
<tr class="firstRow thead"><td class="table_cell" width="226" valign="top"><span>错误代码</span></td><td class="table_cell" width="194" valign="top"><span>描述</span></td><td class="table_cell" width="231" valign="top"><span>解决方案</span></td></tr>
<tr><td class="table_cell" width="226"><span>CA_ERROR</span></td><td class="table_cell" width="194"><span>请求未携带证书，或请求携带的证书出错</span></td><td class="table_cell" width="231"><span>到商户平台下载证书，请求带上证书后重试。</span></td></tr>
<tr><td class="table_cell" width="226"><span>SIGN_ERROR</span></td><td class="table_cell" width="194"><span>商户签名错误</span></td><td class="table_cell" width="231"><span>按文档要求重新生成签名后再重试。</span></td></tr>
<tr><td class="table_cell" width="226"><span>NO_AUTH</span></td><td class="table_cell" width="194"><span>没有权限</span></td><td class="table_cell" width="231"><span>请联系微信支付开通api权限。</span></td></tr>
<tr><td class="table_cell" width="226"><span>FREQ_LIMIT</span></td><td class="table_cell" width="194"><span>受频率限制</span></td><td class="table_cell" width="231"><span>请对请求做频率控制</span></td></tr>
<tr><td class="table_cell" width="226"><span>XML_ERROR</span></td><td class="table_cell" width="194"><span>请求的xml格式错误，或者post的数据为空</span></td><td class="table_cell" width="231"><span>检查请求串，确认无误后重试</span></td></tr>
<tr><td class="table_cell" width="226"><span>PARAM_ERROR</span></td><td class="table_cell" width="194"><span>参数错误</span></td><td class="table_cell" width="231"><span>请查看err_code_des，修改设置错误的参数</span></td></tr>
<tr><td class="table_cell" width="226"><span>OPENID_ERROR</span></td><td class="table_cell" width="194"><span>Openid错误</span></td><td class="table_cell" width="231"><span>根据用户在商家公众账号上的openid，获取用户在红包公众账号上的openid 错误。请核对商户自身公众号appid和用户在此公众号下的openid。</span></td></tr>
<tr><td class="table_cell" width="226"><span>NOTENOUGH</span></td><td class="table_cell" width="194"><span>余额不足</span></td><td class="table_cell" width="231"><span>商户账号余额不足，请登录微信支付商户平台充值</span></td></tr>
<tr><td class="table_cell" width="226"><span>FATAL_ERROR</span></td><td class="table_cell" width="194"><span>重复请求时，参数与原单不一致</span></td><td class="table_cell" width="231"><span>使用相同商户单号进行重复请求时，参数与第一次请求时不一致，请检查并修改参数后再重试。</span></td></tr>
<tr><td class="table_cell" width="226"><span>TIME _LIMITED</span></td><td class="table_cell" width="194"><span>企业红包的发送时间受限</span></td><td class="table_cell" width="231"><span>请北京时间0：00-8：00时间之外触发红包赠送</span></td></tr>
<tr><td class="table_cell" width="226"><span>SECOND_OVER_LIMITED</span></td><td class="table_cell" width="194"><span>企业红包的按分钟发放受限</span></td><td class="table_cell" width="231"><span>每分钟发送红包数量不得超过1800个；（可联系微信支付wxhongbao@tencent.com调高额度）</span></td></tr>
<tr><td class="table_cell" width="226"><span>DAY_ OVER_LIMITED</span></td><td class="table_cell" width="194"><span>企业红包的按天日发放受限</span></td><td class="table_cell" width="231"><span>单个商户日发送红包数量不大于10000个；（可联系微信支付wxhongbao@tencent.com调高额度）</span></td></tr>
<tr><td class="table_cell" width="226"><span>MONEY_LIMIT</span></td><td class="table_cell" width="194"><span>红包金额发放限制</span></td><td class="table_cell" width="231"><span>每个红包金额必须大于1元，小于1000元（可联系微信支付wxhongbao@tencent.com调高额度至4999元）</span></td></tr>
<tr><td class="table_cell" width="226"><span>SEND_FAILED</span></td><td class="table_cell" width="194"><span>红包发放失败，请更换单号再重试。</span></td><td class="table_cell" width="231"><span>原商户单号已经失败，如果还要对同一个用户发放红包， 需要更换新的商户单号再试。</span></td></tr>
<tr><td class="table_cell" width="226"><span>SYSTEMERROR</span></td><td class="table_cell" width="194"><span>系统繁忙，请再试。</span></td><td class="table_cell" width="231"><span>可用同一商户单号再次调用，只会发放一个红包。 &nbsp;</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p><span><strong>签名算法</strong></span></p>
<p><span>第一步，设所有发送或者接收到的数据为集合M，将集合M内非空参数值的参数按照参数名ASCII码从小到大排序（字典序），使用URL键值对的格式（即key1=value1&amp;key2=value2…）拼接成字符串stringA。</span></p>
<div data-tag="backcolor">
<p><span>特别注意以下重要规则：<br>参数名ASCII码从小到大排序（字典序）；<br>如果参数的值为空不参与签名；<br>参数名区分大小写；<br>验证调用返回或微信主动通知签名时，传送的sign参数不参与签名，将生成的签名与该sign值作校验。
<br></span></p>
</div>
<p><span>第二步，在stringA最后拼接上key=商户支付密钥得到stringSignTemp字符串，并对stringSignTemp进行MD5运算，再将得到的字符串所有字符转换为大写，得到sign值signValue。</span></p>
<div data-tag="backcolor">
<p><span>举例：<br>假设传送的参数如下：<br>appid： wxd930ea5d5a258f4f<br>mch_id： 10000100<br>device_info： 1000<br>Body： test<br>nonce_str： ibuaiVcKdpRxkhJA<br>第一步：对参数按照key=value的格式，并按照参数名ASCII字典序排序如下：stringA="appid=wxd930ea5d5a258f4f&amp;body=test&amp;device_info=1000&amp;mch_id=10000100&amp;nonce_str=ibuaiVcKdpRxkhJA";<br>第二步：拼接支付密钥：<br>stringSignTemp="stringA&amp;key=192006250b4c09247ec02edce69f6a2d"<br>sign=MD5(stringSignTemp).toUpperCase()="9A0A8659F005D6984697E2CA0A9CF3B7"<br>最终得到最终发送的数据：<br>&lt;xml&gt;&nbsp;<br>&lt;appid&gt;wxd930ea5d5a258f4f&lt;/appid&gt;&nbsp;<br>&lt;mch_id&gt;10000100&lt;/mch_id&gt;&nbsp;<br>&lt;device_info&gt;1000&lt;/device_info&gt;&nbsp;<br>&lt;body&gt;test&lt;/body&gt;&nbsp;<br>&lt;nonce_str&gt;ibuaiVcKdpRxkhJA&lt;/nonce_str&gt;&nbsp;<br>&lt;sign&gt;9A0A8659F005D6984697E2CA0A9CF3B7&lt;/sign&gt;&nbsp;<br>&lt;/xml&gt;
<br></span></p>
</div>
<p><span><strong>生成随机数算法</strong></span></p>
<p><span>微信支付API接口协议中包含固定nonce_str，主要保证签名不可预测。我们推荐生成随机数算法如下：</span></p>
<p><span>调用随机数生成函数，将得到的值转换为字符串。	
<br>
<br></span></p>
<p><span><strong>商户证书</strong></span></p>
<p><span>1. 获取商户证书</span></p>
<p><span>微信支付接口中，涉及资金回滚的接口会使用到商户证书，包括退款、撤销接口。商家在申请微信支付成功后，收到的相应邮件通知中，附件会包含接口需要用到的证书文件，有四个证书文件，分别说明如下。</span></p>
<p><span>证书文件说明：</span></p>
<table class="table" width="951">
<tbody class="tbody">
<tr class="firstRow thead"><td class="table_cell" width="180" valign="top"><span>证书附件</span></td><td class="table_cell" width="169" valign="top"><span>描述</span></td><td class="table_cell" width="131" valign="top"><span>使用场景
<br></span></td><td class="table_cell" width="170" valign="top"><span>备注</span></td></tr>
<tr><td class="table_cell" width="180"><span>pkcs12格式(apiclient_cert.p12)</span></td><td class="table_cell" width="169"><span>包含了私钥信息的证书文件，为p12(pfx)格式，由微信支付签发给您用来标识和界定您的身份</span></td><td class="table_cell" width="131"><span>撤销、退款申请API中调用</span></td><td class="table_cell" width="170"><span>windows上可以直接双击导入系统，导入过程中会提示输入证书密码，证书密码默认为您的商户ID（如：10010000）</span></td></tr>
<tr><td class="table_cell" width="180"><span>证书pem格式（apiclient_cert.pem）</span></td><td class="table_cell" width="169"><span>从apiclient_cert.p12中导出证书部分的文件，为pem格式，请妥善保管不要泄漏和被他人复制</span></td><td class="table_cell" width="131"><span>PHP等不能直接使用p12文件，而需要使用pem，为了方便您使用，已为您直接提供</span></td><td class="table_cell" width="170"><span>您也可以使用openssl命令来自己导出：openssl pkcs12 -clcerts -nokeys -in apiclient_cert.p12 -out apiclient_cert.pem</span></td></tr>
<tr><td class="table_cell" width="180"><span>证书密钥pem格式（apiclient_key.pem）</span></td><td class="table_cell" width="169"><span>从apiclient_cert.p12中导出密钥部分的文件，为pem格式</span></td><td class="table_cell" width="131"><span>PHP等不能直接使用p12文件，而需要使用pem，为了方便您使用，已为您直接提供</span></td><td class="table_cell" width="170"><span>您也可以使用openssl命令来自己导出：openssl pkcs12 -nocerts -in apiclient_cert.p12 -out apiclient_key.pem</span></td></tr>
<tr><td class="table_cell" width="180"><span>CA证书（rootca.pem）</span></td><td class="table_cell" width="169"><span>微信支付api服务器上也部署了证明微信支付身份的服务器证书，您在使用api进行调用时也需要验证所调用服务器及域名的真实性</span></td><td class="table_cell" width="131"><span>该文件为签署微信支付证书的权威机构的根证书，可以用来验证微信支付服务器证书的真实性</span></td><td class="table_cell" width="170"><span>部分工具已经内置了若干权威机构的根证书，无需引用该证书也可以正常进行验证，这里提供给您在未内置所必须根证书的环境中载入使用 &nbsp;&nbsp;</span></td></tr>
</tbody>
</table>
<p><span>2. 使用商户证书</span></p>
<p><span>apiclient_cert.p12是商户证书文件，除PHP外的开发均使用此证书文件。<br>商户如果使用.NET环境开发，请确认Framework版本大于2.0，必须在操作系统上双击安装证书apiclient_cert.p12后才能被正常调用。<br>商户证书调用或安装都需要使用到密码，该密码的值为微信商户号（mchid）<br>PHP开发环境请使用商户证书文件apiclient_cert.pem和apiclient_key.pem ，rootca.pem是CA证书。
<br></span></p>
<p><span>3. 商户证书安全</span></p>
<p><span>证书文件放在非web服务器虚拟目录的文件夹下，防止被他人下载。商户服务器要做好病毒和木马防护工作，不被非法侵入者窃取证书文件。</span></p>
<p><span>
<br></span></p>
</div>
</div>
</div>
</div>
</body>
</html>