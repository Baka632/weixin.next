
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link onerror="wx_loaderror(this)" onerror="wx_loaderror(this)" rel="stylesheet" type="text/css" href="https://res.wx.qq.com/mpres/htmledition/style/page/resource/res_iframe2f613f.css"/></head>
<body class="page_doc">
<div class="main_hd"><h2>投放卡券</h2>
</div>
<div class="main_bd">
<div class="article_box">
<div class="inner">
<div class="news_content">
<p>
<br></p>
<h2><strong><span>更新日志</span></strong></h2>
<table cellspacing="0" cellpadding="2" align="left">
<tbody>
<tr class="firstRow thead"><th class="table_cell" align="left" valign="top"><span>版本号</span></th><th class="table_cell" align="left" valign="top"><span>更新内容</span></th><th class="table_cell" align="left" valign="top"><span>更新时间</span></th></tr>
<tr><td class="table_cell"><span>V1.1</span></td><td class="table_cell">
<p><span>1.新增卡券货架创建接口，支持开发者调用接口创建卡券货架进行卡券投</span><span>放</span></p>
<p><span>2. 新增导入code接口，支持自定义code开发者通过导入code通过群发、客服等渠道 派发卡券</span></p>
</td><td class="table_cell"><span>2015-8-12</span></td></tr>
<tr><td class="table_cell"><span>V1.2</span></td><td class="table_cell"><span>新增扫描二维码批量领取接口，用户扫描二维码可以同时领取多张卡券</span></td><td class="table_cell"><span>2015-8-31
<br>
<br></span></td></tr>
</tbody>
</table>
<p><strong><span>
<br></span></strong></p>
<p><strong><span>
<br></span></strong></p>
<p><strong><span>
<br></span></strong></p>
<p><strong><span>
<br></span></strong></p>
<p><strong><span>
<br></span></strong></p>
<p>
<br></p>
<p><strong><span>
<br></span></strong></p>
<p><strong><span>目录</span></strong></p>
<p><a href="#1" target="_self" textvalue="1 创建二维码接口"><span>1 创建二维码接口</span></a></p>
<p><a href="#2" target="_self"><span>2 HTML5网页发券（JS-SDK）</span></a></p>
<p><a href="#3" target="_self"><span>3 通过卡券货架投放卡券</span></a></p>
<p><span>&nbsp;&nbsp;<a href="#3.1" target="_self">3.1 创建货架接口</a></span></p>
<p><a href="#4" target="_self"><span>4 群发卡券</span></a></p>
<p><span>&nbsp;&nbsp;<a href="#4.1" target="_self">4.1 导入自定义code</a></span></p>
<p><span>&nbsp;&nbsp;<a href="#4.2" target="_self">4.2 图文消息群发卡券</a></span></p>
<p><span>&nbsp;&nbsp;<a href="#4.3" target="_self">4.3 根据分组群发卡券消息</a></span></p>
<p><span>&nbsp;&nbsp;<a href="#4.4" target="_self">4.4 根据OpenID列表群发卡券消息</a></span></p>
<p><span>&nbsp;&nbsp;<a href="#4.5" target="_self">4.5 客服消息下发卡券</a></span></p>
<p><span>&nbsp;&nbsp;<a href="#4.6" target="_self">4.6 预览接口</a></span></p>
<p><a href="#5" target="_self"><span>5 投放渠道数据统计</span></a></p>
<p><span><a href="#6" target="_self">6 设置测试白名单</a></span></p>
<p>
<br></p>
<h2><strong><a name="1"></a>1&nbsp;创建二维码接口</strong></h2>
<p><span><br>开发者可调用该接口生成一张卡券二维码供用户扫码后添加卡券到卡包。</span></p>
<p><span>自定义Code码的卡券调用接口时，POST数据中需指定code，非自定义code不需指定，指定openid同理。指定后的二维码只能被用户扫描领取一次。</span></p>
<p>
<br></p>
<p><span>获取二维码ticket后，开发者可用</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1443433542&amp;token=&amp;lang=zh_CN" target="_blank"><span>通过ticket换取二维码接口</span></a><span>换取二维码图片详情。</span></p>
<p><span>
<br></span></p>
<p><span><strong>接口调用请求说明</strong></span></p>
<pre><span>HTTP请求方式:&nbsp;POST<br>URL:https://api.weixin.qq.com/card/qrcode/create?access_token=TOKEN
<br></span></pre>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>参数说明</strong></span></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数</span></th><th class="table_cell"><span>是否必须</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>POST数据</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>JSON数据</span></td></tr>
<tr><td class="table_cell"><span>access_token</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>调用接口凭证</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>POST数据</strong>&nbsp;
<br></span></p>
<p><span>开发者可以设置扫描二维码领取单张卡券，此时POST数据为：</span></p>
<pre><span>&nbsp;{<br>"action_name":&nbsp;"QR_CARD",&nbsp;<br>"expire_seconds":&nbsp;1800,<br>"action_info":&nbsp;{<br>"card":&nbsp;{<br>"card_id":&nbsp;"pFS7Fjg8kV1IdDz01r4SQwMkuCKc",&nbsp;<br>"code":&nbsp;"198374613512",<br>"openid":&nbsp;"oFS7Fjl0WsZ9AMZqrI80nbIq8xrA",<br>"is_unique_code":&nbsp;false&nbsp;,<br>"outer_str":"12b"<br>&nbsp;&nbsp;}<br>&nbsp;}<br>}
<br></span></pre>
<p><span>
<br></span></p>
<p><span>当开发者设置扫描二维码领取多张卡券，此时POST数据为：</span></p>
<pre><span>{<br>"action_name":&nbsp;"QR_MULTIPLE_CARD",&nbsp;<br>"action_info":&nbsp;{<br>"multiple_card":&nbsp;{<br>"card_list":&nbsp;[<br>{<br>"card_id":&nbsp;"p1Pj9jgj3BcomSgtuW8B1wl-wo88",<br>"code":"2392583481",<br>"outer_str":"12b"<br>},&nbsp;<br>{<br>"card_id":&nbsp;"p1Pj9jgj3BcomSgtuW8B1wl-wo98",<br>"code":"2392583482",<br>"outer_str":"12b"<br>}<br>]<br>}<br>}<br>}
<br></span></pre>
<p><strong>
<br></strong></p>
<p><span><strong>参数说明</strong></span></p>
<p><span><strong>
<br></strong></span></p>
<table cellspacing="0" cellpadding="4" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell" align="left" valign="top"><span>参数名</span></th><th class="table_cell" align="left" valign="top"><span>必填</span></th><th class="table_cell" align="left" valign="top"><span>类型</span></th><th class="table_cell" align="left" valign="top"><span>示例值</span></th><th class="table_cell" align="left" valign="top"><span>描述</span></th></tr>
<tr><td class="table_cell"><span>code</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>string(20)</span></td><td class="table_cell"><span>110201201245</span></td><td class="table_cell"><span>卡券Code码,use_custom_code字段为true的卡券必须填写，非自定义code和导入code模式的卡券不必填写。</span></td></tr>
<tr><td class="table_cell"><span>card_id</span></td><td class="table_cell"><span>否</span></td><td class="table_cell"><span>string(32)</span></td><td class="table_cell"><span>pFS7Fjg8kV1IdD<br>z01r4SQwMkuCKc</span></td><td class="table_cell"><span>卡券ID。</span></td></tr>
<tr><td class="table_cell"><span>openid</span></td><td class="table_cell"><span>否</span></td><td class="table_cell"><span>string(32)</span></td><td class="table_cell"><span>oXch-jkrxp42VQu8ld<br>weCwDt97qo</span></td><td class="table_cell"><span>指定领取者的openid，只有该用户能领取。bind_openid字段为true的卡券必须填写，非指定openid不必填写。</span></td></tr>
<tr><td class="table_cell"><span>expire_seconds</span></td><td class="table_cell"><span>否</span></td><td class="table_cell"><span>unsigned int</span></td><td class="table_cell"><span>60</span></td><td class="table_cell"><span>指定二维码的有效时间，范围是60 ~ 1800秒。不填默认为365天有效</span></td></tr>
<tr><td class="table_cell"><span>is_unique_code</span></td><td class="table_cell"><span>否</span></td><td class="table_cell"><span>bool</span></td><td class="table_cell"><span>false</span></td><td class="table_cell"><span>指定下发二维码，生成的二维码随机分配一个code，领取后不可再次扫描。填写true或false。默认false，注意填写该字段时，卡券须通过审核且库存不为0。</span></td></tr>
<tr><td class="table_cell"><span>outer_id</span></td><td class="table_cell"><span>否</span></td><td class="table_cell"><span>int</span></td><td class="table_cell"><span>12</span></td><td class="table_cell"><span>领取场景值，用于领取渠道的数据统计，默认值为0，字段类型为整型，长度限制为60位数字。用户领取卡券后触发的</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025274&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="事件推送"><span>事件推送</span></a><span>中会带上此自定义场景值。</span></td></tr>
<tr><td class="table_cell" colspan="1" rowspan="1">
<p><span>outer_str</span></p>
</td><td class="table_cell" colspan="1" rowspan="1"><span>否</span></td><td class="table_cell" colspan="1" rowspan="1"><span>string(128)</span></td><td class="table_cell" colspan="1" rowspan="1"><span>13b</span></td><td class="table_cell" colspan="1" rowspan="1">
<p><span>outer_id字段升级版本，字符串类型，用户首次领卡时，会通过<a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025274&amp;token=&amp;lang=zh_CN" target="_blank">领取事件推送</a>给商户；</span></p>
<p><span>对于会员卡的二维码，用户每次扫码打开会员卡后点击任何url，会将该值拼入url中，方便开发者定位扫码来源</span></p>
</td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p>
<br></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p>
<br></p>
<p>
<br></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>返回数据</strong></span></p>
<p><span><strong>
<br></strong></span></p>
<pre><span>{<br>&nbsp;"errcode":&nbsp;0,<br>&nbsp;"errmsg":&nbsp;"ok",<br>&nbsp;"ticket":&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"gQHB8DoAAAAAAAAAASxodHRwOi8vd2VpeGluLnFxLmNvbS9xL0JIV3lhX3psZmlvSDZmWGVMMTZvAAIEsNnKVQMEIAMAAA==",//获取ticket后需调用换取二维码接口获取二维码图片，详情见字段说明。<br>&nbsp;"expire_seconds":&nbsp;1800,<br>&nbsp;"url":&nbsp;"http://weixin.qq.com/q/BHWya_zlfioH6fXeL16o&nbsp;",<br>&nbsp;"show_qrcode_url":&nbsp;"&nbsp;https://mp.weixin.qq.com/cgi-bin/showqrcode?&nbsp;&nbsp;ticket=gQH98DoAAAAAAAAAASxodHRwOi8vd2VpeGluLnFxLmNvbS9xL0czVzRlSWpsamlyM2plWTNKVktvAAIE6SfgVQMEgDPhAQ%3D%3D"<br>&nbsp;}
<br></span></pre>
<p>
<br></p>
<p><strong>&nbsp; &nbsp;参数说明</strong></p>
<table cellspacing="0" cellpadding="7" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数名</span></th><th class="table_cell"><span>描述</span></th></tr>
<tr><td class="table_cell"><span>errcode</span></td><td class="table_cell"><span>错误码</span></td></tr>
<tr><td class="table_cell"><span>errmsg</span></td><td class="table_cell"><span>错误信息</span></td></tr>
<tr><td class="table_cell"><span>ticket</span></td><td class="table_cell"><span>获取的二维码ticket，凭借此ticket调用</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1443433542&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="通过ticket换取二维码接口"><span>通过ticket换取二维码接口</span></a><span>可以在有效时间内换取二维码。</span></td></tr>
<tr><td class="table_cell"><span>url</span></td><td class="table_cell"><span>二维码图片解析后的地址，开发者可根据该地址自行生成需要的二维码图片</span></td></tr>
<tr><td class="table_cell"><span>show_qrcode_url</span></td><td class="table_cell"><span>二维码显示地址，点击后跳转二维码页面</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p><span><em>
<br></em></span></p>
<p><span><em>注意事项</em>：</span></p>
<p>
<br></p>
<p><span>自定义code的卡券，生成的二维码每次只能领取一次，若开发者想要使用自己的串码系统并且想要用微信的二维码
<br></span></p>
<p><span>投放，须先将<a href="#4.1" target="_self" textvalue="自定义code导入">自定义code导入</a>；</span></p>
<p>
<br></p>
<h2><span><strong><a name="2"></a>2 HTML5线上发券（JS-SDK接口）</strong></span></h2>
<p><span>微信 JS-SDK 仅支持在微信内置浏览器中使用,其他浏览器调用无效。</span></p>
<p><span>微信提供addCard接口供商户前端网页调用,用于将一张或多张卡券添加到用户卡包。详情见</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421141115&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="批量添加卡券接口"><span>批量添加卡券接口</span></a><span>。</span></p>
<p><img src="http://mmbiz.qpic.cn/mmbiz/PiajxSqBRaEIQxibpLbyuSK30vbk0CEJvxDozKeqjjM5PZ9ZaE5gzDgPBNjknWtO5bnZofm56rDdArMzdvTIz1ug/0?wx_fmt=png" title="" alt=""></p>
<p>
<br></p>
<h2><span><strong><a name="3"></a>3&nbsp;通过卡券货架投放卡券</strong></span></h2>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>卡券货架简介</strong></span></p>
<p><span>卡券货架支持开发者通过调用接口生成一个卡券领取H5页面，并获取页面链接，进行卡券投放动作。&nbsp;<span>目前卡券货架仅支持非自定义code的卡券</span>，自定义code的卡券需先调用</span><a href="#4.1" target="_self" textvalue="导入code接口"><span>导入code接口</span></a><span>将code导入才能正常使用。</span></p>
<p><img src="http://mmbiz.qpic.cn/mmbiz/PiajxSqBRaEIQxibpLbyuSK30vbk0CEJvx49ibY7JqUD82It2HS6k1ACONpF1PMIS1j5IMF2H8ZuFXmXOtXdM6JEw/0?wx_fmt=png" title="" alt=""></p>
<h3><span><strong><a name="3.1"></a>3.1&nbsp;创建货架接口</strong></span></h3>
<p><span><strong>接口说明</strong></span></p>
<p><span>开发者需调用该接口创建货架链接，用于卡券投放。创建货架时需填写投放路径的场景字段。</span></p>
<p>
<br><span><strong>接口调用请求说明</strong></span></p>
<pre><span>HTTP请求方式:&nbsp;POST<br>URL:https://api.weixin.qq.com/card/landingpage/create?access_token=$TOKEN
<br></span></pre>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>请求参数说明</strong></span></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数</span></th><th class="table_cell"><span>是否必须</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>access_token</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>调用接口凭证</span></td></tr>
<tr><td class="table_cell"><span>buffer</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>文件的数据流</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>POST数据</strong></span></p>
<pre><span>{&nbsp;&nbsp;<br>"banner":"http://mmbiz.qpic.cn/mmbiz/iaL1LJM1mF9aRKPZJkmG8xXhiaHqkKSVMMWeN3hLut7X7h&nbsp;&nbsp;icFN",<br>&nbsp;&nbsp;&nbsp;"page_title":&nbsp;"惠城优惠大派送",<br>&nbsp;&nbsp;&nbsp;"can_share":&nbsp;true,<br>&nbsp;&nbsp;&nbsp;"scene":&nbsp;"SCENE_NEAR_BY",<br>&nbsp;&nbsp;&nbsp;"card_list":&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"card_id":&nbsp;"pXch-jnOlGtbuWwIO2NDftZeynRE",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"thumb_url":&nbsp;"www.qq.com/a.jpg"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"card_id":&nbsp;"pXch-jnAN-ZBoRbiwgqBZ1RV60fI",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"thumb_url":&nbsp;"www.qq.com/b.jpg"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;]<br>}
<br></span></pre>
<p><span>
<br></span></p>
<p><strong><span>参数说明</span></strong></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>说明</span></th><th class="table_cell"><span>是否必填</span></th></tr>
<tr><td class="table_cell"><span>banner</span></td><td class="table_cell"><span>页面的banner图片链接，须调用，建议尺寸为640*300。</span></td><td class="table_cell"><span>是</span></td></tr>
<tr><td class="table_cell"><span>title</span></td><td class="table_cell"><span>页面的title。</span></td><td class="table_cell"><span>是</span></td></tr>
<tr><td class="table_cell"><span>can_share</span></td><td class="table_cell"><span>页面是否可以分享,填入true/false</span></td><td class="table_cell"><span>是</span></td></tr>
<tr><td class="table_cell"><span>scene</span></td><td class="table_cell"><span>投放页面的场景值；</span>
<p><span>SCENE_NEAR_BY 附近 SCENE_MENU	自定义菜单 SCENE_QRCODE	二维码 SCENE_ARTICLE	公众号文章 SCENE_H5	h5页面 SCENE_IVR	自动回复 SCENE_CARD_CUSTOM_CELL	卡券自定义cell</span></p>
</td><td class="table_cell"><span>是</span></td></tr>
<tr><td class="table_cell"><span>card_list</span></td><td class="table_cell"><span>卡券列表，每个item有两个字段</span></td><td class="table_cell"><span>是</span></td></tr>
<tr><td class="table_cell"><span>card_id</span></td><td class="table_cell"><span>所要在页面投放的card_id</span></td><td class="table_cell"><span>是</span></td></tr>
<tr><td class="table_cell"><span>thumb_url</span></td><td class="table_cell"><span>缩略图url</span></td><td class="table_cell"><span>是</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><strong>
<br></strong></p>
<p><strong>返回数据说明</strong>
<br></p>
<pre><span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"errcode":0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"errmsg":"ok",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"url":"www.test.url",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"page_id":1<br>&nbsp;}
<br></span></pre>
<p><span>
<br></span></p>
<p><strong><span>字段说明</span></strong></p>
<p>
<br></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>errcode</span></td><td class="table_cell"><span>错误码，0为正常。</span></td></tr>
<tr><td class="table_cell"><span>errmsg</span></td><td class="table_cell"><span>错误信息。</span></td></tr>
<tr><td class="table_cell"><span>url</span></td><td class="table_cell"><span>货架链接。</span></td></tr>
<tr><td class="table_cell"><span>page_id</span></td><td class="table_cell"><span>货架ID。货架的唯一标识。</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<h2><span><strong><a name="4"></a>4&nbsp;群发卡券</strong></span></h2>
<p><span>请开发者特别注意，目前群发卡券接口仅支持投放非自定义Code码的卡券。自定义code码的商户若想使用该功能需调用导入code接口将自定义code先导入微信服务器。</span></p>
<p><span>
<br></span></p>
<p><span>自定义Code码与非自定义Code码的区别见</span><a href="#4.1" target="_self" textvalue="是否自定义Code码"><span>是否自定义Code码</span></a><span>。</span></p>
<p><span>
<br></span></p>
<h3><span><strong><a name="4.1"></a>4.1&nbsp;导入自定义code(仅对自定义code商户)</strong></span></h3>
<p><span><strong>接口简介</strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><span>该模块只针对自定义code商户，非自定义code开发者请自动忽略。</span>&nbsp;开发者可以将自定义code提前导入至微信服务器，以获得和非自定义code商户同样的投放能力，如分组群发、客服消息下发卡券等。</span></p>
<p><span><em><span>导入code后的卡券在投放时等同于非自定义code卡券</span></em></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>新创建卡券</strong></span></p>
<p><span>如果开发者打算新创建一张支持导入code模式的卡券，不同于以往的创建方式，建议开发者采用以下流程创建预存code模式卡券，否则会报错。</span></p>
<p><span>
<br></span></p>
<p><em><span>步骤一：</span></em><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025056&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="创建"><em><span>创建</span></em></a><em><span>预存模式卡券，将库存quantity初始值设置为0，并填入get_custom_code_mode字段；</span></em></p>
<p><em><span>步骤二：待卡券通过审核后，调用</span></em><a href="#4.1.1" target="_self" textvalue="导入code接口"><em><span>导入code接口</span></em></a><em><span>并</span></em><a href="#4.1.4" target="_self" textvalue="核查code"><em><span>核查code</span></em></a><em><span>；</span></em></p>
<p><em><span>步骤三：调用</span></em><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025272&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="修改库存接口"><em><span>修改库存接口</span></em></a><em><span>，须令卡券库存小于或等于导入code的数目。（为了避免混乱建议设置为相等）</span></em></p>
<p><span>
<br></span></p>
<p><img src="http://mmbiz.qpic.cn/mmbiz/PiajxSqBRaEIQxibpLbyuSKyv7L5vzxedz9zCU20B5hiawCguUBVeSbkiaprF0dMwaS1UxcPEPahGQgicSwmGxtgXYw/0?wx_fmt=png" title="" alt=""></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>非新创建卡券</strong></span></p>
<p><span>如果开发者已经有一张卡券，想把它改为预存code模式，建议开发者按照以下流程对卡券进行更新。</span></p>
<p><span>
<br></span></p>
<p><em><span>步骤一：调用</span></em><a href="#4.1.2" target="_self" textvalue="导入code接口"><em><span>导入code接口</span></em></a><em><span>导入一定量的自定义code并</span></em><a href="#4.1.4" target="_self" textvalue="核查code"><em><span>核查code</span></em></a><em><span>；</span></em></p>
<p><em><span>步骤二：调用</span></em><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025272&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="更改卡券信息接口"><em><span>更改卡券信息接口</span></em></a><em><span>填入get_custom_code_mode字段；</span></em></p>
<p><em><span>步骤三：调用</span></em><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025272&amp;token=&amp;lang=zh_CN" target="_blank" title="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025272&amp;token=&amp;lang=zh_CN" textvalue="修改库存接口"><em><span>修改库存接口</span></em></a><em><span>将卡券库存quantity设置为与导入code数目相等的数字。</span></em></p>
<p><em><span>
<br></span></em></p>
<p><img src="http://mmbiz.qpic.cn/mmbiz/PiajxSqBRaEIQxibpLbyuSKyv7L5vzxedz4lotPicnbJZl5WicYL7DbVVr2Mc20ea4hW6dfGicf6GAoaicgQAS3caw2Q/0?wx_fmt=png" title="" alt=""></p>
<p>
<br></p>
<h4><span><strong><a name="4.1.1"></a>4.1.1&nbsp;填入/更新导入code必需字段</strong></span></h4>
<p><span><strong>接口说明</strong></span></p>
<p><span>自定义code的卡券仅支持API创建，创建时务必在base_info中加入以下字段(详情见接口文档CreateCard创建卡券接口)， 加入以下两个指定字段后，才可以调用code导入接口进行code导入</span></p>
<p>
<br></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>示例</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>base_info</span></td><td class="table_cell">
<br></td><td class="table_cell">
<br></td></tr>
<tr><td class="table_cell"><span>get_custom_code_mode</span></td><td class="table_cell"><span>GET_CUSTOM_CODE_MODE_DEPOSIT</span></td><td class="table_cell"><span>填入该字段后，自定义code卡券方可进行导入code并投放的动作。</span></td></tr>
<tr><td class="table_cell"><span>use_custom_code</span></td><td class="table_cell"><span>true</span></td><td class="table_cell"><span>将卡券设置为自定义code</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>创建卡券时JSON示例</p>
<pre>{
&nbsp;"card":&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"card_type":&nbsp;"GROUPON",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"groupon":&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"base_info":&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;··········
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"use_custom_code":true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"get_custom_code_mode":"GET_CUSTOM_CODE_MODE_DEPOSIT",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"advanced_info":&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;··········
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"deal_detail":&nbsp;"示例"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;}
}</pre>
<p>更新卡券时JSON示例</p>
<pre>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"card_id":"ph_gmt7cUVrlRk8swPwx7aDyF-pg",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"groupon":&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"base_info":&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;·········		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"get_custom_code_mode":"GET_CUSTOM_CODE_MODE_DEPOSIT",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;·········
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;}</pre>
<p>
<br></p>
<p><em><span>&nbsp;注意事项：</span></em></p>
<p><em><span>&nbsp;创建/更新填入get_custom_code_mode时，须检查库存数与已经导入code数目的关系，当导入code的数目小于库存数时，会报错。</span></em></p>
<p>
<br></p>
<h4><span><strong><a name="4.1.2"></a>4.1.2&nbsp;导入code接口</strong></span></h4>
<p><span>在自定义code卡券<span>成功创建并且通过审核</span>后，必须将自定义code按照与发券方的约定数量调用导入code接口导入微信后台。</span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>接口说明</strong></span></p>
<p><em><span>开发者可调用该接口将自定义code导入微信卡券后台，由微信侧代理存储并下发code。</span></em></p>
<p><em><span>注： 1）单次调用接口传入code的数量上限为100个。</span></em></p>
<p><em><span>2）每一个 code 均不能为空串。</span></em></p>
<p><em><span>3）导入结束后系统会自动判断提供方设置库存与实际导入code的量是否一致。</span></em></p>
<p><em><span>4）导入失败支持重复导入，提示成功为止。</span></em></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>接口调用请求说明</strong></span></p>
<pre><span>HTTP请求方式:&nbsp;POST<br>URL:http://api.weixin.qq.com/card/code/deposit?access_token=ACCESS_TOKEN
<br></span></pre>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>请求参数说明</strong></span></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数</span></th><th class="table_cell"><span>是否必须</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>access_token</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>调用接口凭证</span></td></tr>
<tr><td class="table_cell"><span>buffer</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>文件的数据流</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>POST数据</strong></span></p>
<pre><span>{<br>&nbsp;&nbsp;&nbsp;"card_id":&nbsp;"pDF3iY0_dVjb_Pua96MMewA96qvA",<br>&nbsp;&nbsp;&nbsp;"code":&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"11111",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"22222",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"33333",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"44444",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"55555"<br>&nbsp;&nbsp;&nbsp;]<br>}
<br></span></pre>
<p>
<br><strong><span>字段说明</span></strong></p>
<p><strong><span>
<br></span></strong></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>说明</span></th><th class="table_cell"><span>是否必填</span></th></tr>
<tr><td class="table_cell"><span>card_id</span></td><td class="table_cell"><span>需要进行导入code的卡券ID。</span></td><td class="table_cell"><span>是</span></td></tr>
<tr><td class="table_cell"><span>code</span></td><td class="table_cell"><span>需导入微信卡券后台的自定义code，上限为100个。</span></td><td class="table_cell"><span>是</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>返回数据说明</strong></span></p>
<pre><span>{<br>&nbsp;&nbsp;"errcode":0,<br>&nbsp;&nbsp;"errmsg":"ok"<br>}
<br></span></pre>
<p><strong><span>
<br></span></strong></p>
<p><strong><span>字段说明</span></strong></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>errcode</span></td><td class="table_cell"><span>错误码，0为正常；40109：code数量超过100个</span></td></tr>
<tr><td class="table_cell"><span>errmsg</span></td><td class="table_cell"><span>错误信息。</span></td></tr>
<tr><td class="table_cell"><span>succ_code</span></td><td class="table_cell"><span>成功个数</span></td></tr>
<tr><td class="table_cell"><span>duplicate_code</span></td><td class="table_cell"><span>重复导入的code会自动被过滤。</span></td></tr>
<tr><td class="table_cell"><span>fail_code</span></td><td class="table_cell"><span>失败个数。</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<h4><span><strong><a name="4.1.3"></a>4.1.3&nbsp;查询导入code数目接口</strong></span></h4>
<p><span><strong>接口说明</strong></span></p>
<p><span>支持开发者调用该接口查询code导入微信后台成功的数目。</span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>接口调用请求说明</strong></span></p>
<pre><span>HTTP请求方式:&nbsp;POST<br>URL:http://api.weixin.qq.com/card/code/getdepositcount?access_token=ACCESS_TOKEN
<br></span></pre>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>请求参数说明</strong></span></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数</span></th><th class="table_cell"><span>是否必须</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>access_token</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>调用接口凭证</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>POST数据</strong></span></p>
<pre><span>{<br>&nbsp;&nbsp;&nbsp;"card_id"&nbsp;:&nbsp;"&nbsp;pDF3iY0_dVjb_Pua96MMewA96qvA&nbsp;"<br>}
<br></span></pre>
<p>
<br><strong><span>字段说明</span></strong></p>
<p><strong><span>
<br></span></strong></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>说明</span></th><th class="table_cell"><span>是否必填</span></th></tr>
<tr><td class="table_cell"><span>card_id</span></td><td class="table_cell"><span>进行导入code的卡券ID。</span></td><td class="table_cell"><span>是</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>返回数据说明</strong></span></p>
<p><span><strong>
<br></strong></span></p>
<pre><span>{<br>&nbsp;&nbsp;"errcode":0,<br>&nbsp;&nbsp;"errmsg":"ok"，<br>&nbsp;&nbsp;"count":123<br>}
<br></span></pre>
<p>
<br><strong><span>字段说明</span></strong></p>
<p>
<br></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>errcode</span></td><td class="table_cell"><span>错误码，0为正常。</span></td></tr>
<tr><td class="table_cell"><span>errmsg</span></td><td class="table_cell"><span>错误信息。</span></td></tr>
<tr><td class="table_cell"><span>count</span></td><td class="table_cell"><span>已经成功存入的code数目。</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<h4><span><strong><a name="4.1.4"></a>4.1.4&nbsp;核查code接口</strong></span></h4>
<p><span>为了避免出现导入差错，强烈建议开发者在查询完code数目的时候核查code接口校验code导入微信后台的情况。</span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>接口说明</strong></span></p>
<p><span>支持开发者调用该接口查询code导入微信后台的情况。</span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>接口调用请求说明</strong></span></p>
<pre><span>HTTP请求方式:&nbsp;POST<br>URL:http://api.weixin.qq.com/card/code/checkcode?access_token=ACCESS_TOKEN
<br></span></pre>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>请求参数说明</strong></span></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数</span></th><th class="table_cell"><span>是否必须</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>access_token</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>调用接口凭证</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p>
<br></p>
<p>
<br></p>
<p><span><strong>POST数据</strong></span></p>
<p><span><strong>
<br></strong></span></p>
<pre><span>{<br>&nbsp;&nbsp;&nbsp;"card_id":&nbsp;"pDF3iY0_dVjb_Pua96MMewA96qvA",<br>&nbsp;&nbsp;&nbsp;"code":&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"11111",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"22222",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"33333",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"44444",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"55555"<br>&nbsp;&nbsp;&nbsp;]<br>}
<br></span></pre>
<p>
<br><strong><span>字段说明</span></strong></p>
<p><strong><span>
<br></span></strong></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>说明</span></th><th class="table_cell"><span>是否必填</span></th></tr>
<tr><td class="table_cell"><span>card_id</span></td><td class="table_cell"><span>进行导入code的卡券ID。</span></td><td class="table_cell"><span>是</span></td></tr>
<tr><td class="table_cell"><span>code</span></td><td class="table_cell"><span>已经微信卡券后台的自定义code，上限为100个。</span></td><td class="table_cell"><span>是</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>返回数据说明</strong></span></p>
<p>
<br></p>
<pre><span>{<br>&nbsp;&nbsp;"errcode":0,<br>&nbsp;&nbsp;"errmsg":"ok"<br>&nbsp;&nbsp;"exist_code":["11111","22222","33333"],<br>&nbsp;&nbsp;"not_exist_code":["44444","55555"]<br>}
<br></span></pre>
<p>
<br><strong><span>字段说明</span></strong></p>
<p>
<br></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>字段</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>errcode</span></td><td class="table_cell"><span>错误码，0为正常；40109：code数量超过100个</span></td></tr>
<tr><td class="table_cell"><span>errmsg</span></td><td class="table_cell"><span>错误信息。</span></td></tr>
<tr><td class="table_cell"><span>exist_code</span></td><td class="table_cell"><span>已经成功存入的code。</span></td></tr>
<tr><td class="table_cell"><span>not_exist_code</span></td><td class="table_cell"><span>没有存入的code。</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<h3><span><strong><a name="4.2"></a>4.2&nbsp;图文消息群发卡券</strong></span></h3>
<p><span>支持开发者调用该接口获取卡券嵌入图文消息的标准格式代码，将返回代码填入</span><a href="http://mp.weixin.qq.com/wiki/15/40b6865b893947b764e2de8e4a1fb55f.html#.E4.B8.8A.E4.BC.A0.E5.9B.BE.E6.96.87.E6.B6.88.E6.81.AF.E7.B4.A0.E6.9D.90.E3.80.90.E8.AE.A2.E9.98.85.E5.8F.B7.E4.B8.8E.E6.9C.8D.E5.8A.A1.E5.8F.B7.E8.AE.A4.E8.AF.81.E5.90.8E.E5.9D.87.E5.8F.AF.E7.94.A8.E3.80.91" rel="nofollow"><span>上传图文素材接口</span></a><span>中content字段，即可获取嵌入卡券的图文消息素材。</span></p>
<p><span>特别注意：目前该接口仅支持填入非自定义code的卡券,自定义code的卡券需先进行code导入后调用。</span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>接口调用请求说明</strong></span></p>
<pre><span>HTTP请求方式:&nbsp;POST<br>URL:https://api.weixin.qq.com/card/mpnews/gethtml?access_token=TOKEN
<br></span></pre>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>参数说明</strong></span></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数</span></th><th class="table_cell"><span>是否必须</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>POST数据</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>Json数据</span></td></tr>
<tr><td class="table_cell"><span>access_token</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>调用接口凭证</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>POST数据</strong></span></p>
<pre><span>{<br>&nbsp;&nbsp;"card_id":"p1Pj9jr90_SQRaVqYI239Ka1erkI"<br>}
<br></span></pre>
<table cellspacing="0" cellpadding="4" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数名</span></th><th class="table_cell"><span>必填</span></th><th class="table_cell"><span>类型</span></th><th class="table_cell"><span>示例值</span></th><th class="table_cell"><span>描述</span></th></tr>
<tr><td class="table_cell"><span>card_id</span></td><td class="table_cell"><span>否</span></td><td class="table_cell"><span>string(32)</span></td><td class="table_cell"><span>pFS7Fjg8kV1IdDz01r4SQwMkuCKc</span></td><td class="table_cell"><span>卡券ID。</span></td></tr>
</tbody>
</table>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>返回数据</strong></span></p>
<pre><span>&nbsp;{<br>"errcode":0,<br>"errmsg":"ok",<br>"content":"&lt;iframeclass=\"res_iframecard_iframejs_editor_card\"data-src=\"http:&nbsp;\/\/mp.weixin.qq.com\/bizmall\/appmsgcard?action=show&amp;biz=MjM5OTAwODk4MA%3D%3D&amp;cardid=p1Pj9jnXTLf2nF7lccYScFUYqJ0&amp;wechat_card_js=1#wechat_redirect\"&gt;"<br>}
<br></span></pre>
<p>
<br></p>
<table cellspacing="0" cellpadding="7" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数名</span></th><th class="table_cell"><span>描述</span></th></tr>
<tr><td class="table_cell"><span>errcode</span></td><td class="table_cell"><span>错误码</span></td></tr>
<tr><td class="table_cell"><span>errmsg</span></td><td class="table_cell"><span>错误信息</span></td></tr>
<tr><td class="table_cell"><span>content</span></td><td class="table_cell"><span>返回一段html代码，可以直接嵌入到图文消息的正文里。即可以把这段代码嵌入到</span><a href="http://mp.weixin.qq.com/wiki/15/40b6865b893947b764e2de8e4a1fb55f.html#.E4.B8.8A.E4.BC.A0.E5.9B.BE.E6.96.87.E6.B6.88.E6.81.AF.E7.B4.A0.E6.9D.90.E3.80.90.E8.AE.A2.E9.98.85.E5.8F.B7.E4.B8.8E.E6.9C.8D.E5.8A.A1.E5.8F.B7.E8.AE.A4.E8.AF.81.E5.90.8E.E5.9D.87.E5.8F.AF.E7.94.A8.E3.80.91" rel="nofollow"><span>上传图文消息素材接口</span></a><span>中的content字段里。</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<p>
<br></p>
<h3><span><strong><a name="4.3"></a>4.3&nbsp;根据分组群发卡券消息</strong></span></h3>
<p><span>支持调用该接口向指定分组的用户群发卡券消息。详情见</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140549&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="根据分组进行群发接口"><span>根据分组进行群发接口</span></a></p>
<p><span>目前该接口仅支持填入非自定义code的卡券,自定义code的卡券需先进行code导入后调用。</span></p>
<p><span>
<br></span></p>
<h3><span><strong><a name="4.4"></a>4.4&nbsp;根据OpenID列表群发卡券消息</strong></span></h3>
<p><span>支持根据OpenID群发原生卡券。订阅号不可用，服务号认证后具备接口权限。详情见</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140549&amp;token=&amp;lang=zh_CN" target="_blank"><span>根据OpenID列表群发接口</span></a></p>
<p><span>目前该接口仅支持填入非自定义code的卡券,自定义code的卡券需先进行code导入后调用。</span></p>
<h3><span><strong><a name="4.5"></a>4.5&nbsp;客服消息下发卡券</strong></span></h3>
<p><span>支持开发者调用该接口下发卡券。订阅号不可用，服务号认证后可用。详情见</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140547&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="客服接口-发消息"><span>客服接口-发消息</span></a></p>
<p><span>目前该接口仅支持填入非自定义code的卡券,自定义code的卡券需先进行code导入后调用。</span></p>
<p><span>
<br></span></p>
<h3><span><strong><a name="4.6"></a>4.6&nbsp;预览接口</strong></span></h3>
<p><span>支持开发者调用该接口下发卡券。订阅号不可用，服务号认证后可用。详情见</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140549&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="预览接口"><span>预览接口</span></a></p>
<p>
<br></p>
<h2><span><strong><a name="5"></a>5&nbsp;投放渠道数据统计</strong></span></h2>
<p><span>为方便开发者统计各渠道的卡券投放数据，新增字段outer_str（原outer_id）。将不同设值的<span>outer_str（原outer_id）</span>填入card_ext的json结构中，当用户领取卡券时会将相应设值的outer_id带入</span><a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025274&amp;token=&amp;lang=zh_CN" target="_blank" textvalue="领取事件"><span>领取事件</span></a><span>中，推送至开发者服务器。</span></p>
<p><span>
<br></span></p>
<p><em><span>示例： 在二维码投放方式中设置outer_str为12b</span></em></p>
<p><span>
<br></span></p>
<pre><span>{<br>"action_name":&nbsp;"QR_CARD",&nbsp;<br>"action_info":&nbsp;{<br>"card":&nbsp;{<br>"card_id":&nbsp;"pFS7Fjg8kV1IdDz01r4SQwMkuCKc",&nbsp;<br>"code":&nbsp;"198374613512",<br>"openid":&nbsp;"oFS7Fjl0WsZ9AMZqrI80nbIq8xrA",<br>"expire_seconds":&nbsp;"1800"，<br>"is_unique_code":&nbsp;false&nbsp;,<br>"outer_str"&nbsp;:&nbsp;"12b"<br>&nbsp;&nbsp;}<br>&nbsp;}<br>}
<br></span></pre>
<p>
<br><span>领取事件XML文件</span></p>
<pre><span>&lt;xml&gt;&nbsp;&lt;ToUserName&gt;&lt;![CDATA[toUser]]&gt;&lt;/ToUserName&gt;&nbsp;<br>&lt;FromUserName&gt;&lt;![CDATA[FromUser]]&gt;&lt;/FromUserName&gt;&nbsp;<br>&lt;FriendUserName&gt;&lt;![CDATA[FriendUser]]&gt;&lt;/FriendUserName&gt;&nbsp;<br>&lt;CreateTime&gt;123456789&lt;/CreateTime&gt;&nbsp;<br>&lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt;&nbsp;<br>&lt;Event&gt;&lt;![CDATA[user_get_card]]&gt;&lt;/Event&gt;&nbsp;<br>&lt;CardId&gt;&lt;![CDATA[cardid]]&gt;&lt;/CardId&gt;&nbsp;<br>&lt;IsGiveByFriend&gt;1&lt;/IsGiveByFriend&gt;<br>&lt;UserCardCode&gt;&lt;![CDATA[12312312]]&gt;&lt;/UserCardCode&gt;<br>&lt;OuterStr&gt;12b&lt;/OuterStr&gt;<br>&lt;/xml&gt;
<br></span></pre>
<h2><span><strong><a name="6"></a>6&nbsp;设置测试白名单</strong></span></h2>
<p><span><strong>接口说明</strong></span></p>
<p><span>由于卡券有审核要求，为方便公众号调试，可以设置一些测试帐号，这些帐号可领取未通过审核的卡券，体验整个流程。</span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>开发者注意事项</strong></span></p>
<p><em><span>1.同时支持“openid”、“username”两种字段设置白名单，总数上限为10个。</span></em></p>
<p><em><span>2.设置测试白名单接口为全量设置，即测试名单发生变化时需调用该接口重新传入所有测试人员的ID.</span></em></p>
<p><em><span>3.白名单用户领取该卡券时将无视卡券失效状态，请开发者注意。</span></em></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>接口调用请求说明</strong></span></p>
<pre><span>HTTP请求方式:&nbsp;POST<br>URL:https://api.weixin.qq.com/card/testwhitelist/set?access_token=TOKEN
<br></span></pre>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>参数说明</strong></span></p>
<p>
<br></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数</span></th><th class="table_cell"><span>是否必须</span></th><th class="table_cell"><span>说明</span></th></tr>
<tr><td class="table_cell"><span>access_token</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>调用接口凭证</span></td></tr>
<tr><td class="table_cell"><span>POST数据</span></td><td class="table_cell"><span>是</span></td><td class="table_cell"><span>Json数据</span></td></tr>
</tbody>
</table>
<p><strong>
<br></strong></p>
<p>
<br></p>
<p><strong>
<br></strong></p>
<p><strong>
<br></strong></p>
<p><strong>
<br></strong></p>
<p><strong>
<br></strong></p>
<p><strong>POST数据</strong></p>
<pre><span>{<br>&nbsp;&nbsp;"openid":&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"o1Pj9jmZvwSyyyyyyBa4aULW2mA",&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"o1Pj9jmZvxxxxxxxxxULW2mA"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br>&nbsp;&nbsp;"username":&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"afdvvf",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"abcd"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>&nbsp;}
<br></span></pre>
<p>
<br><strong>参数说明</strong></p>
<p><span><strong>
<br></strong></span></p>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数名</span></th><th class="table_cell"><span>必填</span></th><th class="table_cell"><span>类型</span></th><th class="table_cell"><span>示例值</span></th><th class="table_cell"><span>描述</span></th></tr>
<tr><td class="table_cell"><span>openid</span></td><td class="table_cell"><span>否</span></td><td class="table_cell"><span>string(20)</span></td><td class="table_cell"><span>o1Pj9jmZvwSyyyyyyBa4aULW2mA</span></td><td class="table_cell"><span>测试的openid列表。</span></td></tr>
<tr><td class="table_cell"><span>username</span></td><td class="table_cell"><span>否</span></td><td class="table_cell"><span>string（32）</span></td><td class="table_cell"><span>eddy</span></td><td class="table_cell"><span>测试的微信号列表。</span></td></tr>
</tbody>
</table>
<p>
<br></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><span><strong>
<br></strong></span></p>
<p><strong>返回说明</strong></p>
<pre><span>{<br>&nbsp;&nbsp;&nbsp;"errcode":0,<br>&nbsp;&nbsp;&nbsp;"errmsg":"ok"<br>}
<br></span></pre>
<table cellspacing="0" cellpadding="2" align="left" width="700px">
<tbody>
<tr class="firstRow thead"><th class="table_cell"><span>参数名</span></th><th class="table_cell"><span>描述</span></th></tr>
<tr><td class="table_cell"><span>errcode</span></td><td class="table_cell"><span>错误码，0为正常。</span></td></tr>
<tr><td class="table_cell"><span>errmsg</span></td><td class="table_cell"><span>错误信息。</span></td></tr>
</tbody>
</table>
<p><span></span></p>
</div>
</div>
</div>
</div>
</body>
</html>