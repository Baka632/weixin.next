
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link onerror="wx_loaderror(this)" onerror="wx_loaderror(this)" rel="stylesheet" type="text/css" href="https://res.wx.qq.com/mpres/htmledition/style/page/resource/res_iframe2f613f.css"/></head>
<body class="page_doc">
<div class="main_hd"><h2>红包JSAPI</h2>
</div>
<div class="main_bd">
<div class="article_box">
<div class="inner">
<div class="news_content">
<p><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;"><strong>接口说明</strong>
<br></span></p>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">在第三方页面中，通过调用JSAPI来触发用户抽红包的操作，如果抽到红包，会呼出微信的原生红包页面。用户只有通过摇周边的入口才能抽中红包。每个用户在一个活动抽奖id下最多只能中一个红包。创建红包活动时，选择使用模板页面的开发者不需要调用该接口</span></p>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">引入BeaconShakehbJsBridge'</span></p>
<div data-tag="backcolor" style="white-space: normal; margin-bottom: 14px; padding: 10px 16px; background-color: rgb(253, 234, 218);">
<p><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">&lt;scripttype="text/javascript"src="http://zb.weixin.qq.com/app/shakehb/BeaconShakehbJsBridge.js"&gt;<br>&lt;/script&gt;
<br></span></p>
</div>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;"><strong>API详细说明</strong></span></p>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">抽红包JS API调用与微信的JS API调用格式一致，如下：</span></p>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">函数：invoke<br>用途：主动调用指定API<br>通用形式：BeaconShakehbJsBridge.invoke("API名称", {调用参数});<br>API 名称：jumpHongbao<br>参数：openid、lottery_id、noncestr、sign<br>回调函数：无
<br></span></p>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;"><strong>调用参数说明</strong></span></p>
<table class="table">
<tbody class="tbody">
<tr class="firstRow thead"><td class="table_cell" width="687" valign="top" style="word-break: break-all;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">参数</span></td><td class="table_cell" width="687" valign="top" style="word-break: break-all;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">说明</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">openid</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">用户openid。必填</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">lottery_id</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">红包抽奖id，必填，来自addlotteryinfo返回的lottery_id</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">noncestr</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">随机字符串，不长于32位。必填</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">sign</span></td><td class="table_cell" style="word-break: break-all;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">签名，详见下面的签名生成规则 &nbsp;</span></td></tr>
</tbody>
</table>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;"><strong>Sign生成规则</strong></span></p>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">1.除sign字段外，所有参数按照字段名的ASCII码从小到大排序后（字典序），使用URL键值对的格式（即Param1=value1&amp;Param2=value2…）拼接而成签名原始串，空值不参与签名组串。<br>2.签名原始串中，字段名和字段值都采用原始值，不进行URL转义。&nbsp;<br>3.签名原始串末尾补上key参数(通过“创建红包活动”接口设置的key)，如 Param1=value1&amp;Param2=value2…&amp;key=keyvalue&nbsp;<br>4.得到的字符串进行MD5，并转换为大写。即 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sign=ToUpperCase(MD5(Param1=value1&amp;Param2=value2…&amp;key=keyvalue))<br>5.出于安全考虑，开发者必须在服务器端实现生成签名的逻辑。
<br></span></p>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;"><strong>请求示例</strong></span></p>
<div data-tag="backcolor" style="white-space: normal; margin-bottom: 14px; padding: 10px 16px; background-color: rgb(253, 234, 218);">
<p><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">BeaconShakehbJsBridge.ready(function(){<br>//跳转到抽红包页面<br>&nbsp; &nbsp; BeaconShakehbJsBridge.invoke('jumpHongbao',{<br>&nbsp; &nbsp; lottery_id:'LOTTERY_ID ',<br>&nbsp; &nbsp; noncestr:'378507853820041854759013507217',<br>&nbsp; &nbsp; openid:'OPENID',<br>&nbsp; &nbsp; sign:'SIGN'<br>});<br>});
<br></span></p>
</div>
<p style="white-space: normal;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;"><strong>用户侧错误码说明</strong></span></p>
<table class="table">
<tbody class="tbody">
<tr class="firstRow thead"><td class="table_cell" width="333" valign="top" style="word-break: break-all;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">提示文案</span></td><td class="table_cell" width="333" valign="top" style="word-break: break-all;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">错误码</span></td><td class="table_cell" width="333" valign="top" style="word-break: break-all;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">错误信息</span></td><td class="table_cell" width="333" valign="top" style="word-break: break-all;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">解决方案</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">5</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">摇周边ticket过期</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">检查是不是从微信摇一摇进入</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11002</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">摇一摇ticket不存在</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">检查是不是从微信摇一摇进入</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11003</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">无效的摇一摇ticket</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">检查是不是从微信摇一摇进入</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11004</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">获取商户appid失败</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">检查是不是从微信摇一摇进入</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11005</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">摇周边频率检查失败</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">检查是不是从微信摇一摇进入</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11009</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">系统异常</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">请重试</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11010</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">随机字符串长度过长</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">对自定义页面时调jsapi参数校验出错，请检查</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11011</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">LotteryID解析失败</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">对自定义页面时调jsapi参数校验出错，请检查</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11012</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">签名校验失败</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">对自定义页面时调jsapi参数校验出错，请检查</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11013</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">openid无效</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">对自定义页面时调jsapi参数校验出错，请检查</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">11014</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">pass_ticket无效</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">检查是不是从微信摇一摇进入</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">12013</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">绑定用户和红包失败</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">抽到红包ticket后，微信支付返回的错误</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">12014</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">微信支付查询红包ticket失败</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">抽到红包ticket后，微信支付返回的错误</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">12015</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">抽奖操作频率过高</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">请重试</span></td></tr>
<tr><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">出错了</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">12019</span></td><td class="table_cell"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">page_id无效</span></td><td class="table_cell" style="word-break: break-all;"><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">使用模版时校验出错&nbsp;
<br>
<br></span></td></tr>
</tbody>
</table>
<p><span style="font-family: 微软雅黑, 'Microsoft YaHei'; font-size: 14px;">
<br></span></p>
</div>
</div>
</div>
</div>
</body>
</html>